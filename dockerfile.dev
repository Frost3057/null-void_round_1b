# Development Dockerfile - Optimized for fast builds and testing
FROM python:3.9-slim-bullseye

# Environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1

WORKDIR /app

# Install only essential system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    tesseract-ocr \
    poppler-utils \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Copy and install minimal requirements for development
COPY requirements.dev.txt* requirements.txt ./
RUN pip install --no-cache-dir --upgrade pip && \
    if [ -f requirements.dev.txt ]; then \
        pip install --no-cache-dir -r requirements.dev.txt; \
    else \
        pip install --no-cache-dir -r requirements.txt; \
    fi

# Copy application code
COPY . /app/

# Create necessary directories
RUN mkdir -p output_1A output_1B

# Default to running validation (faster than full pipeline)
CMD ["python", "validate_multilingual.py", "--input_dir", "output_1A", "--detailed"]
